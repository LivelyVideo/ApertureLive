openapi: 3.0.3
info:
  title: QR Response API
  description: API for handling QR code responses with WebRTC configuration and widget metadata
  version: 1.0.0
  
servers:
  - url: https://api.example.com/v1
    description: Production server

paths:
  /qr-response:
    get:
      summary: Get QR Response Configuration
      description: Retrieves QR response data including WebRTC configuration, widgets, and metadata
      operationId: getQRResponse
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QRResponse'
        '400':
          description: Bad request
        '404':
          description: QR code not found
        '500':
          description: Internal server error

components:
  schemas:
    QRResponse:
      type: object
      properties:
        headers:
          type: object
          additionalProperties:
            type: string
          description: HTTP headers as key-value pairs
          example:
            Authorization: "Bearer token123"
            Content-Type: "application/json"
        metadata:
          $ref: '#/components/schemas/Metadata'
        whip:
          type: string
          description: WHIP (WebRTC HTTP Ingestion Protocol) endpoint URL
          example: "https://whip.example.com/ingest"
        stun_urls:
          type: array
          items:
            type: string
          deprecated: true
          description: DEPRECATED - Array of STUN server URLs (use ice_servers instead)
          example:
            - "stun:stun.example.com:3478"
            - "stun:stun2.example.com:3478"
        ice_servers:
          type: array
          items:
            $ref: '#/components/schemas/RTCIceServer'
          description: Array of ICE server configurations for WebRTC
      required:
        - metadata

    Metadata:
      type: object
      properties:
        version:
          type: integer
          default: 1
          description: Metadata version number
          example: 1
        options:
          $ref: '#/components/schemas/Options'
        widgets:
          type: array
          items:
            $ref: '#/components/schemas/Widget'
          description: Array of widget configurations
        privacy:
          type: boolean
          nullable: true
          deprecated: true
          description: DEPRECATED - Privacy mode enabled (moved to metadata.options.privacy)
          example: true
        location:
          type: boolean
          nullable: true
          description: Location services enabled
          example: false
        ptt:
          type: boolean
          nullable: true
          description: Push-to-talk enabled
          example: false
        locationHref:
          type: string
          description: Location reference URL
          example: "https://example.com/location"
      required:
        - version

    Options:
      type: object
      properties:
        pendingValues:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          description: Dictionary of pending values with string array values
          example:
            setting1: ["value1", "value2"]
            setting2: ["value3"]
        privacy:
          type: boolean
          nullable: true
          description: Privacy mode enabled (moved from metadata.privacy)
          example: true
        ui:
          allOf:
            - $ref: '#/components/schemas/UI'
          nullable: true
          description: UI configuration options

    UI:
      type: object
      properties:
        compact:
          type: boolean
          nullable: true
          description: Compact UI mode
          example: false
        hideBar:
          type: boolean
          nullable: true
          description: Hide the navigation bar
          example: false
        contentMargin:
          type: integer
          nullable: true
          description: Content margin in pixels
          example: 16

    Widget:
      type: object
      properties:
        url:
          type: string
          format: uri
          description: Widget URL
          example: "https://widget.example.com/embed"
        headers:
          type: object
          additionalProperties:
            type: string
          description: HTTP headers for widget requests
          example:
            Authorization: "Bearer widgetToken"
        key:
          type: string
          description: Widget identifier key
          example: "widget-123"
        cookies:
          type: array
          items:
            $ref: '#/components/schemas/CookieData'
          description: Array of cookie configurations for the widget
        fullscreen:
          type: boolean
          default: false
          deprecated: true
          description: DEPRECATED - Widget fullscreen mode (use metadata.options.ui instead)
          example: false
        safearea:
          type: boolean
          default: false
          deprecated: true
          description: DEPRECATED - Widget safe area mode (use metadata.options.ui instead)
          example: false
      required:
        - url
        - key

    CookieData:
      type: object
      properties:
        httpOnly:
          type: boolean
          description: HTTP-only flag
          example: true
        sameSite:
          type: string
          enum: [Strict, Lax, None]
          description: SameSite cookie attribute
          example: "Lax"
        path:
          type: string
          description: Cookie path
          example: "/"
        domain:
          type: string
          description: Cookie domain
          example: ".example.com"
        secure:
          type: boolean
          description: Secure flag (HTTPS only)
          example: true
        name:
          type: string
          description: Cookie name
          example: "session_id"
        value:
          type: string
          description: Cookie value
          example: "abc123xyz"
      required:
        - name
        - value

    RTCIceServer:
      type: object
      properties:
        urls:
          oneOf:
            - type: string
            - type: array
              items:
                type: string
          description: ICE server URL(s) (STUN/TURN)
          example: "stun:stun.example.com:3478"
        username:
          type: string
          description: Username for TURN server authentication
          example: "user123"
        credential:
          type: string
          description: Credential for TURN server authentication
          example: "password123"
        credentialType:
          type: string
          enum: [password, oauth]
          description: Type of credential
          example: "password"
      required:
        - urls